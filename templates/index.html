<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Risultati Ricerca</title>
    <style>
        html,
        body,
        #viewDiv {
            padding: 10px;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="viewDiv"></div>
<h1>Ricerca Chiesa</h1>
<form action="/" method="GET">
    <label for="search_input">Inserisci il nome della chiesa:</label><br>
    <input type="text" id="search_input" name="query"><br>
    <button type="submit">Cerca</button>
</form>

{% if chiese %}
<h2>Risultati della ricerca per "{{ query }}"</h2>
<ul>
    {% for chiesa in chiese %}
    <li>
        <h3>Chiesa: {{ chiesa["Locale Nome della Chiesa"] }}</h3>
        <p>Indirizzo: {{ chiesa["Indirizzo"] }}</p>
        <h4>Reperti:</h4>
        <ul>
            {% for reperto in reperti %}
            {% if reperto["Codice Chiesa"] == chiesa["Codice Chiesa"] %}
            <li>
                <h5>Nome Reperto: {{ reperto["Primario Nome"] }}</h5>
                <p>Altro Materiale: {{ reperto["Altro Materiale"] }}</p>
                <p>Anno di Morte: {{ reperto["Anno di Morte"] }}</p>
                <p>Anno di Nascita: {{ reperto["Anno di Nascita"] }}</p>
                <p>Arte: {{ reperto["Arte"] }}</p>
                <p>Chiavistello: {{ reperto["Chiavistello"] }}</p>
                <p>Codice Chiesa: {{ reperto["Codice Chiesa"] }}</p>
                <p>Codice Reperto: {{ reperto["Codice Reperto"] }}</p>
                <p>Cognome: {{ reperto["Cognome"] }}</p>
                <p>Commenti: {{ reperto["Commenti"] }}</p>
                <p>Data Rilevamento: {{ reperto["Data"] }}</p>
                <p>Data di Morte: {{ reperto["Data di Morte"] }}</p>
                <p>Data di Nascita: {{ reperto["Data di Nascita"] }}</p>
                <p>Davanti: {{ reperto["Davanti"] }}</p>
                <p>Destra: {{ reperto["Destra"] }}</p>
                <p>Età di Morte: {{ reperto["Età di Morte"] }}</p>
                <p>Forma: {{ reperto["Forma"] }}</p>
                <p>Traduzione in Inglese: {{ reperto["Inglese"] }}</p>
                <p>Inscrizione: {{ reperto["Inscrizione"] }}</p>
                <p>Italiano: {{ reperto["Italiano"] }}</p>
                <p>Larghezza: {{ reperto["Larghezza"] }}</p>
                <p>Latino: {{ reperto["Latino"] }}</p>
                <p>Lunghezza: {{ reperto["Lunghezza"] }}</p>
                <p>Luogo: {{ reperto["Luogo"] }}</p>
                <p>MAPINFO_ID: {{ reperto["MAPINFO_ID"] }}</p>
                <p>Mese di Nascita: {{ reperto["Mese di Nascita"] }}</p>
                <p>Mese di Morte: {{ reperto["Mese di Morte"] }}</p>
                <p>Nome: {{ reperto["Nome"] }}</p>
                <p>Orientazione de Geografico: {{ reperto["Orientazione de Geografico"] }}</p>
                <p>Coordinata X: {{ reperto["Posizione - X Coordinato"] }}</p>
                <p>Coordinata Y: {{ reperto["Posizione - Y Coordinato"] }}</p>
                <p>Primario Materiale: {{ reperto["Primario Materiale"] }}</p>
                <p>Primario Nome: {{ reperto["Primario Nome"] }}</p>
                <p>Professione: {{ reperto["Professione"] }}</p>
                <p>Retro {{ reperto["Retro"] }}</p>
                <p>Secondo Nome: {{ reperto["Secondo Nome"] }}</p>
                <p>Sinistra: {{ reperto["Sinistra"] }}</p>
                <p>Testo di Fotografia: {{ reperto["Testo di Fotographia"] }}</p>
                <p>Tipo: {{ reperto["Tipo"] }}</p>
                <!-- Aggiungi qui altri attributi specifici del reperto -->
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </li>
    {% endfor %}
</ul>
{% else %}
{% if query %}
<p>Nessun risultato trovato per "{{ query }}".</p>
{% endif %}
{% endif %}

<div id="mapViewDiv" style="height: 400px; width: 100%;"></div>

<link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css">
<script src="https://js.arcgis.com/4.29/"></script>
<script>
    require([
        "esri/WebMap",
        "esri/views/MapView",
        "esri/config",
        "dojo/domReady!"
    ], function(WebMap, MapView, esriConfig) {
        // Imposta la chiave API per l'autenticazione
        esriConfig.apiKey = "AAPK28024a6180ac48739d279d7a90c08c37z2nA-K4du-xQN6XMFh2rgWo6uM53XTVwJg3XJ8OIXlN5y3i9uyRJh3S6dHbZdzn9";

        var webmap = new WebMap({
            portalItem: {
                id: "5ae37f33f52a4eefbc098507ddd9f92d" // Sostituisci con l'ID della tua mappa ArcGIS
            }
        });

        var view = new MapView({
            container: "mapViewDiv",
            map: webmap
        });
    });
</script>
</body>
</html>
